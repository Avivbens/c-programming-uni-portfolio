---
name: PR Health Checks 🐛
on:
    pull_request:
        branches:
            - master
    push:
        branches:
            - master

permissions:
    contents: read
    actions: read
    pull-requests: write

jobs:
    PR-checks:
        runs-on: windows-2019
        name: PR Health Checks 🐛
        defaults:
            run:
                shell: msys2 {0}
        steps:
            - name: 📦 Setup Machine
              uses: msys2/setup-msys2@v2
              with:
                  install: gcc make

            - name: 📀 Checkout
              uses: actions/checkout@v3
              with:
                  fetch-depth: 0

            - name: 🖥️ Setup Env
              uses: ./.github/workflows/install

            - name: 'Derive appropriate SHAs for base and head for `nx affected` commands'
              uses: nrwl/nx-set-shas@v4
              with: { main-branch-name: 'master' }

            - name: 🧪 Check out repository code
              uses: ./.github/workflows/health-check
              with:
                  run-lint: false
                  run-tests: false
                  run-build: true
                  run-build-command: 'npx nx affected --target=build --parallel'
