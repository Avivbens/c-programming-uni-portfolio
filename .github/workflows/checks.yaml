---
name: PR Health Checks ğŸ›
on:
    pull_request:
        branches:
            - master
    push:
        branches:
            - master

permissions:
    contents: read
    actions: read
    pull-requests: write

jobs:
    PR-checks:
        runs-on: windows-2019
        name: PR Health Checks ğŸ›
        defaults:
            run:
                shell: msys2 {0}
        steps:
            - name: ğŸ“¦ Setup Machine
              uses: msys2/setup-msys2@v2
              with:
                  install: gcc make bash

            - name: ğŸ“€ Checkout
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: ğŸ–¥ï¸ Setup Env
              uses: ./.github/workflows/install

            - name: 'Derive appropriate SHAs for base and head for `nx affected` commands'
              uses: nrwl/nx-set-shas@v4
              with: { main-branch-name: 'master' }

            - name: ğŸ§ª Check out repository code
              uses: ./.github/workflows/health-check
              with:
                  run-tests: true
                  run-tests-command: 'npx nx affected --target=test --parallel'
                  run-lint: true
                  run-lint-command: 'npx nx affected --target=format-check --parallel'
                  run-build: true
                  run-build-command: 'npx nx affected --target=build --parallel'
